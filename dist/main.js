(()=>{"use strict";var t=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}return t.dotRaw=function(t,e,n,i){return t*n+e*i},t.dot=function(t,e){return this.dotRaw(t.x,t.y,e.x,e.y)},t.prototype.dot=function(e){return t.dot(this,e)},t.crossRaw=function(t,e,n,i){return t*i-n*e},t.cross=function(t,e){return this.crossRaw(t.x,t.y,e.x,e.y)},t.prototype.cross=function(e){return t.cross(this,e)},t.lenRaw=function(t,e){return Math.sqrt(Math.pow(t,2)+Math.pow(e,2))},t.len=function(t){return this.lenRaw(t.x,t.y)},t.prototype.len=function(){return t.len(this)},t.normalizeRaw=function(t,e,n){void 0===n&&(n=1);var i=n/this.lenRaw(t,e);return this.mulRaw(t,e,i)},t.normalize=function(t,e){return void 0===e&&(e=1),this.normalizeRaw(t.x,t.y,e)},t.prototype.normalize=function(e){return void 0===e&&(e=1),t.normalize(this,e)},t.equalsRaw=function(t,e,n,i){return t===n&&e===i},t.equals=function(t,e){return this.equalsRaw(t.x,t.y,e.x,e.y)},t.prototype.equals=function(e){return t.equals(this,e)},t.addRaw=function(e,n,i,r){return new t(e+i,n+r)},t.add=function(t,e){return this.addRaw(t.x,t.y,e.x,e.y)},t.prototype.add=function(e){return t.add(this,e)},t.subRaw=function(e,n,i,r){return new t(e-i,n-r)},t.sub=function(t,e){return this.subRaw(t.x,t.y,e.x,e.y)},t.prototype.sub=function(e){return t.sub(this,e)},t.mulRaw=function(e,n,i){return new t(e*i,n*i)},t.mul=function(t,e){return this.mulRaw(t.x,t.y,e)},t.prototype.mul=function(e){return t.mul(this,e)},t.intersectionTimesRaw=function(e,n,i,r,s,o,u,a){var h=this.crossRaw(i-e,r-n,u-s,a-o);return new t(this.crossRaw(u-s,a-o,e-s,n-o)/h,this.crossRaw(i-e,r-n,e-s,n-o)/h)},t.intersectionTimes=function(t,e,n,i){return this.intersectionTimesRaw(t.x,t.y,e.x,e.y,n.x,n.y,i.x,i.y)},t.prototype.intersectionTimes=function(e,n,i){return t.intersectionTimes(this,e,n,i)},t.intersectionRaw=function(t,e,n,i,r,s,o,u){var a=this.intersectionTimesRaw(t,e,n,i,r,s,o,u);if(a)return a.y=e+(i-e)*a.x,a.x=t+(n-t)*a.x,a},t.intersection=function(t,e,n,i){return this.intersectionRaw(t.x,t.y,e.x,e.y,n.x,n.y,i.x,i.y)},t.prototype.intersection=function(e,n,i){return t.intersection(this,e,n,i)},t.prototype.angle=function(t){if(t){var e=this.angle(),n=t.angle();return n<e?n+2*Math.PI-e:n-e}return this.y>0?Math.acos(this.x/this.len()):2*Math.PI-Math.acos(this.x/this.len())},t}(),e=function(){function e(e,n,i,r){this.v1=new t(e,n),this.v2=new t(i,r)}return Object.defineProperty(e.prototype,"x1",{get:function(){return this.v1.x},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"y1",{get:function(){return this.v1.y},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"x2",{get:function(){return this.v2.x},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"y2",{get:function(){return this.v2.y},enumerable:!1,configurable:!0}),e.prototype.len=function(){return this.v2.sub(this.v1).len()},e.prototype.before=function(t){return this.v1.add(this.v2.sub(this.v1).mul(-t/this.len()))},e.prototype.after=function(t){return this.v1.add(this.v2.sub(this.v1).mul((this.len()+t)/this.len()))},e.prototype.intersectionTimesWith=function(t){return this.v1.intersectionTimes(this.v2,t.v1,t.v2)},e.prototype.update=function(t,e,n,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),this.v1.x+=t,this.v1.y+=e,this.v2.x+=n,this.v2.y+=i},e}(),n=function(){function t(t){var n,i,r,s,o=this;this.renderer=t,this.lines=[],this.intersectionTimes=[],this.renderer.setMouseDownHandler((function(t,r,s){i=s||null,(n=r||null)||(n=new e(t.clientX,t.clientY,t.clientX,t.clientY),i=n.v2,o.addLine(n))})),this.renderer.setMouseUpHandler((function(t,e,u){e?(r&&r!==e&&o.renderer.drawLine(r,e===s,!1),r=e,o.renderer.drawLine(r,e===s,!0)):r&&o.renderer.drawLine(r,e===s,!1),n=null,i=null})),this.renderer.setMouseMoveHandler((function(t,e,u){e?(s&&s!==e&&o.renderer.drawLine(s,!1,e===r),s=e,o.renderer.drawLine(s,!0,e===r)):s&&(o.renderer.drawLine(s,!1,e===r),s=null),n&&(i?(i.x=t.clientX,i.y=t.clientY):n.update(t.movementX,t.movementY,t.movementX,t.movementY),o.updateIntersectionTimes(n),o.renderer.drawLine(n,n===s,n===r))}))}return t.prototype.addLine=function(t){this.addIntersectionTimes(t),this.lines.push(t),this.renderer.drawLine(t,!1,!1)},t.prototype.addIntersectionTimes=function(t){for(var e,n=[],i=0;i<this.lines.length;i++)e=this.lines[i].intersectionTimesWith(t),this.intersectionTimes[i].push(e.x),n.push(e.y);this.intersectionTimes.push(n)},t.prototype.updateIntersectionTimes=function(t){for(var e,n=this.lines.indexOf(t),i=0;i<this.lines.length;i++)i!==n&&(e=this.lines[i].intersectionTimesWith(t),this.intersectionTimes[i][n]=e.x,this.intersectionTimes[n][i]=e.y);console.log(this.intersectionTimes)},t}(),i=document.createElementNS("http://www.w3.org/2000/svg","g");i.setAttribute("stroke","black"),i.setAttribute("stroke-width","0.4px");var r=document.createElementNS("http://www.w3.org/2000/svg","line");r.setAttribute("stroke-dasharray","10, 4, 1, 4");var s=document.createElementNS("http://www.w3.org/2000/svg","path");s.setAttribute("d","M 0, 0A 10, 10, 0, 0, 0, -5, -5A 10, 10, 0, 1, 1, 5, -5A 10, 10, 0, 0, 0, 0, 0"),s.setAttribute("fill","white"),i.appendChild(r),i.appendChild(s),i.appendChild(s.cloneNode());var o=new(function(){function t(){this.svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svgGByLine=new Map,this.lineBySvgG=new Map}return t.prototype.clickHandlerWrapper=function(t){var e=this;return function(n){var i=document.elementFromPoint(n.clientX,n.clientY),r=e.lineBySvgG.get(i.parentNode);i instanceof SVGPathElement?i.parentNode.children[1]===i?t(n,r,r.v1):t(n,r,r.v2):i instanceof SVGLineElement?t(n,r):t(n)}},t.prototype.setMouseDownHandler=function(t){this.onMouseDown&&this.svg.removeEventListener("mousedown",this.onMouseDown),this.onMouseDown=this.clickHandlerWrapper(t),this.svg.addEventListener("mousedown",this.onMouseDown)},t.prototype.setMouseUpHandler=function(t){this.onMouseUp&&this.svg.removeEventListener("mouseup",this.onMouseUp),this.onMouseUp=this.clickHandlerWrapper(t),this.svg.addEventListener("mouseup",this.onMouseUp)},t.prototype.setMouseMoveHandler=function(t){this.onMouseMove&&this.svg.removeEventListener("mousemove",this.onMouseMove),this.onMouseMove=this.clickHandlerWrapper(t),this.svg.addEventListener("mousemove",this.onMouseMove)},t.prototype.drawLine=function(t,e,n){var r;void 0===e&&(e=!1),void 0===n&&(n=!1),this.svgGByLine.has(t)?r=this.svgGByLine.get(t):(r=i.cloneNode(!0),this.svg.appendChild(r),this.svgGByLine.set(t,r),this.lineBySvgG.set(r,t));var s=r.children[0],o=r.children[1],u=r.children[2],a=t.x1.toFixed(),h=t.y1.toFixed(),c=t.x2.toFixed(),d=t.y2.toFixed();s.setAttribute("x1",a),s.setAttribute("y1",h),s.setAttribute("x2",c),s.setAttribute("y2",d),e?r.setAttribute("stroke-width","0.8px"):r.setAttribute("stroke-width","0.4px"),n?r.setAttribute("stroke","#19a194"):r.setAttribute("stroke","black");var l=180*(t.v2.sub(t.v1).angle()-Math.PI/2)/Math.PI;o.setAttribute("transform","translate("+a+", "+h+") rotate("+(isNaN(l)?0:l)+")"),u.setAttribute("transform","translate("+c+", "+d+") rotate("+(isNaN(l)?0:180+l)+")")},t.prototype.eraseLine=function(t){var e=this.svgGByLine.get(t);e&&(this.svg.removeChild(e),this.svgGByLine.delete(t))},t}());new n(o),document.querySelector("body").appendChild(o.svg)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9wb2xwbG90Ly4vc3JjL3ZlY3RvcjIudHMiLCJ3ZWJwYWNrOi8vcG9scGxvdC8uL3NyYy9saW5lLnRzIiwid2VicGFjazovL3BvbHBsb3QvLi9zcmMvcG9scGxvdC50cyIsIndlYnBhY2s6Ly9wb2xwbG90Ly4vc3JjL3N2Zy1yZW5kZXJlci50cyIsIndlYnBhY2s6Ly9wb2xwbG90Ly4vc3JjL2luZGV4LnRzIl0sIm5hbWVzIjpbIngiLCJ5IiwiZG90UmF3IiwieDEiLCJ5MSIsIngyIiwieTIiLCJkb3QiLCJ1IiwidiIsInRoaXMiLCJvdGhlciIsIlZlY3RvcjIiLCJjcm9zc1JhdyIsImNyb3NzIiwibGVuUmF3IiwiTWF0aCIsInNxcnQiLCJwb3ciLCJsZW4iLCJub3JtYWxpemVSYXciLCJieSIsImNvZWYiLCJtdWxSYXciLCJub3JtYWxpemUiLCJlcXVhbHNSYXciLCJlcXVhbHMiLCJhZGRSYXciLCJhZGQiLCJzdWJSYXciLCJzdWIiLCJtdWwiLCJpbnRlcnNlY3Rpb25UaW1lc1JhdyIsImZ4IiwiZnkiLCJ0eCIsInR5Iiwic3giLCJzeSIsImV4IiwiZXkiLCJkZXQiLCJpbnRlcnNlY3Rpb25UaW1lcyIsImZyb20iLCJ0byIsInN0YXJ0IiwiZW5kIiwiaW50ZXJzZWN0aW9uUmF3IiwidGltZXMiLCJpbnRlcnNlY3Rpb24iLCJhbmdsZSIsImExIiwiYTIiLCJQSSIsImFjb3MiLCJ2MSIsInYyIiwiYmVmb3JlIiwidCIsImFmdGVyIiwiaW50ZXJzZWN0aW9uVGltZXNXaXRoIiwidXBkYXRlIiwiZHgxIiwiZHkxIiwiZHgyIiwiZHkyIiwicmVuZGVyZXIiLCJkcmFnZ2VkTGluZSIsImRyYWdnZWRWZWN0b3IyIiwic2VsZWN0ZWRMaW5lIiwiaG92ZXJlZExpbmUiLCJsaW5lcyIsInNldE1vdXNlRG93bkhhbmRsZXIiLCJldmVudCIsImNsaWNrZWRMaW5lIiwiY2xpY2tlZFZlY3RvcjIiLCJMaW5lIiwiY2xpZW50WCIsImNsaWVudFkiLCJhZGRMaW5lIiwic2V0TW91c2VVcEhhbmRsZXIiLCJkcmF3TGluZSIsInNldE1vdXNlTW92ZUhhbmRsZXIiLCJtb3ZlbWVudFgiLCJtb3ZlbWVudFkiLCJ1cGRhdGVJbnRlcnNlY3Rpb25UaW1lcyIsImxpbmUiLCJhZGRJbnRlcnNlY3Rpb25UaW1lcyIsInB1c2giLCJpIiwibGVuZ3RoIiwiaW5kZXgiLCJpbmRleE9mIiwiY29uc29sZSIsImxvZyIsImdUZW1wbGF0ZSIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudE5TIiwic2V0QXR0cmlidXRlIiwibGluZVRlbXBsYXRlIiwiYW5jaG9yVGVtcGxhdGUiLCJhcHBlbmRDaGlsZCIsImNsb25lTm9kZSIsInN2Z1JlbmRlcmVyIiwic3ZnIiwic3ZnR0J5TGluZSIsIk1hcCIsImxpbmVCeVN2Z0ciLCJjbGlja0hhbmRsZXJXcmFwcGVyIiwiY2xpY2tIYW5kbGVyIiwiZWxlbWVudEF0IiwiZWxlbWVudEZyb21Qb2ludCIsImdldCIsInBhcmVudE5vZGUiLCJTVkdQYXRoRWxlbWVudCIsImNoaWxkcmVuIiwiU1ZHTGluZUVsZW1lbnQiLCJvbk1vdXNlRG93biIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJhZGRFdmVudExpc3RlbmVyIiwib25Nb3VzZVVwIiwib25Nb3VzZU1vdmUiLCJpc0hvdmVyZWQiLCJpc1NlbGVjdGVkIiwic3ZnRyIsImhhcyIsInNldCIsInN2Z0xpbmUiLCJzdmdQYXRoQW5jaG9yU3RhcnQiLCJzdmdQYXRoQW5jaG9yRW5kIiwidG9GaXhlZCIsImlzTmFOIiwiZXJhc2VMaW5lIiwicmVtb3ZlQ2hpbGQiLCJkZWxldGUiLCJQb2xQbG90IiwicXVlcnlTZWxlY3RvciJdLCJtYXBwaW5ncyI6Im1CQUFBLGlCQUNFLFdBQW1CQSxFQUFjQyxRQUFkLElBQUFELE1BQUEsUUFBYyxJQUFBQyxNQUFBLEdBQWQsS0FBQUQsSUFBYyxLQUFBQyxJQTRIbkMsT0EzSFMsRUFBQUMsT0FBUCxTQUFjQyxFQUFZQyxFQUFZQyxFQUFZQyxHQUNoRCxPQUFPSCxFQUFL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bnRlbnQiOlsiZXhwb3J0IGNsYXNzIFZlY3RvcjIge1xuICBjb25zdHJ1Y3RvcihwdWJsaWMgeCA9IDAsIHB1YmxpYyB5ID0gMCkge31cbiAgc3RhdGljIGRvdFJhdyh4MTogbnVtYmVyLCB5MTogbnVtYmVyLCB4MjogbnVtYmVyLCB5MjogbnVtYmVyKTogbnVtYmVyIHtcbiAgICByZXR1cm4geDEgKiB4MiArIHkxICogeTI7XG4gIH1cbiAgc3RhdGljIGRvdCh1OiBWZWN0b3IyLCB2OiBWZWN0b3IyKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy5kb3RSYXcodS54LCB1LnksIHYueCwgdi55KTtcbiAgfVxuICBkb3Qob3RoZXI6IFZlY3RvcjIpOiBudW1iZXIge1xuICAgIHJldHVybiBWZWN0b3IyLmRvdCh0aGlzLCBvdGhlcik7XG4gIH1cbiAgc3RhdGljIGNyb3NzUmF3KHgxOiBudW1iZXIsIHkxOiBudW1iZXIsIHgyOiBudW1iZXIsIHkyOiBudW1iZXIpOiBudW1iZXIge1xuICAgIHJldHVybiB4MSAqIHkyIC0geDIgKiB5MTtcbiAgfVxuICBzdGF0aWMgY3Jvc3ModTogVmVjdG9yMiwgdjogVmVjdG9yMik6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMuY3Jvc3NSYXcodS54LCB1LnksIHYueCwgdi55KTtcbiAgfVxuICBjcm9zcyhvdGhlcjogVmVjdG9yMik6IG51bWJlciB7XG4gICAgcmV0dXJuIFZlY3RvcjIuY3Jvc3ModGhpcywgb3RoZXIpO1xuICB9XG4gIHN0YXRpYyBsZW5SYXcoeDogbnVtYmVyLCB5OiBudW1iZXIpOiBudW1iZXIge1xuICAgIHJldHVybiBNYXRoLnNxcnQoTWF0aC5wb3coeCwgMikgKyBNYXRoLnBvdyh5LCAyKSk7XG4gIH1cbiAgc3RhdGljIGxlbih1OiBWZWN0b3IyKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy5sZW5SYXcodS54LCB1LnkpO1xuICB9XG4gIGxlbigpOiBudW1iZXIge1xuICAgIHJldHVybiBWZWN0b3IyLmxlbih0aGlzKTtcbiAgfVxuICBzdGF0aWMgbm9ybWFsaXplUmF3KHg6IG51bWJlciwgeTogbnVtYmVyLCBieTogbnVtYmVyID0gMSk6IFZlY3RvcjIge1xuICAgIGNvbnN0IGNvZWYgPSBieSAvIHRoaXMubGVuUmF3KHgsIHkpO1xuICAgIHJldHVybiB0aGlzLm11bFJhdyh4LCB5LCBjb2VmKTtcbiAgfVxuICBzdGF0aWMgbm9ybWFsaXplKHU6IFZlY3RvcjIsIGJ5OiBudW1iZXIgPSAxKTogVmVjdG9yMiB7XG4gICAgcmV0dXJuIHRoaXMubm9ybWFsaXplUmF3KHUueCwgdS55LCBieSk7XG4gIH1cbiAgbm9ybWFsaXplKGJ5OiBudW1iZXIgPSAxKTogVmVjdG9yMiB7XG4gICAgcmV0dXJuIFZlY3RvcjIubm9ybWFsaXplKHRoaXMsIGJ5KTtcbiAgfVxuICBzdGF0aWMgZXF1YWxzUmF3KHgxOiBudW1iZXIsIHkxOiBudW1iZXIsIHgyOiBudW1iZXIsIHkyOiBudW1iZXIpOiBib29sZWFuIHtcbiAgICByZXR1cm4geDEgPT09IHgyICYmIHkxID09PSB5MjtcbiAgfVxuICBzdGF0aWMgZXF1YWxzKHU6IFZlY3RvcjIsIHY6IFZlY3RvcjIpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5lcXVhbHNSYXcodS54LCB1LnksIHYueCwgdi55KTtcbiAgfVxuICBlcXVhbHMob3RoZXI6IFZlY3RvcjIpOiBib29sZWFuIHtcbiAgICByZXR1cm4gVmVjdG9yMi5lcXVhbHModGhpcywgb3RoZXIpO1xuICB9XG4gIHN0YXRpYyBhZGRSYXcoeDE6IG51bWJlciwgeTE6IG51bWJlciwgeDI6IG51bWJlciwgeTI6IG51bWJlcik6IFZlY3RvcjIge1xuICAgIHJldHVybiBuZXcgVmVjdG9yMih4MSArIHgyLCB5MSArIHkyKTtcbiAgfVxuICBzdGF0aWMgYWRkKHU6IFZlY3RvcjIsIHY6IFZlY3RvcjIpOiBWZWN0b3IyIHtcbiAgICByZXR1cm4gdGhpcy5hZGRSYXcodS54LCB1LnksIHYueCwgdi55KTtcbiAgfVxuICBhZGQob3RoZXI6IFZlY3RvcjIpOiBWZWN0b3IyIHtcbiAgICByZXR1cm4gVmVjdG9yMi5hZGQodGhpcywgb3RoZXIpO1xuICB9XG4gIHN0YXRpYyBzdWJSYXcoeDE6IG51bWJlciwgeTE6IG51bWJlciwgeDI6IG51bWJlciwgeTI6IG51bWJlcik6IFZlY3RvcjIge1xuICAgIHJldHVybiBuZXcgVmVjdG9yMih4MSAtIHgyLCB5MSAtIHkyKTtcbiAgfVxuICBzdGF0aWMgc3ViKHU6IFZlY3RvcjIsIHY6IFZlY3RvcjIpOiBWZWN0b3IyIHtcbiAgICByZXR1cm4gdGhpcy5zdWJSYXcodS54LCB1LnksIHYueCwgdi55KTtcbiAgfVxuICBzdWIob3RoZXI6IFZlY3RvcjIpOiBWZWN0b3IyIHtcbiAgICByZXR1cm4gVmVjdG9yMi5zdWIodGhpcywgb3RoZXIpO1xuICB9XG4gIHN0YXRpYyBtdWxSYXcoeDogbnVtYmVyLCB5OiBudW1iZXIsIGJ5OiBudW1iZXIpOiBWZWN0b3IyIHtcbiAgICByZXR1cm4gbmV3IFZlY3RvcjIoeCAqIGJ5LCB5ICogYnkpO1xuICB9XG4gIHN0YXRpYyBtdWwodTogVmVjdG9yMiwgYnk6IG51bWJlcik6IFZlY3RvcjIge1xuICAgIHJldHVybiB0aGlzLm11bFJhdyh1LngsIHUueSwgYnkpO1xuICB9XG4gIG11bChieTogbnVtYmVyKTogVmVjdG9yMiB7XG4gICAgcmV0dXJuIFZlY3RvcjIubXVsKHRoaXMsIGJ5KTtcbiAgfVxuICBzdGF0aWMgaW50ZXJzZWN0aW9uVGltZXNSYXcoXG4gICAgZng6IG51bWJlciwgZnk6IG51bWJlciwgdHg6IG51bWJlciwgdHk6IG51bWJlcixcbiAgICBzeDogbnVtYmVyLCBzeTogbnVtYmVyLCBleDogbnVtYmVyLCBleTogbnVtYmVyXG4gICk6IFZlY3RvcjIgfCB1bmRlZmluZWQge1xuICAgIGNvbnN0IGRldCA9IHRoaXMuY3Jvc3NSYXcodHggLSBmeCwgdHkgLSBmeSwgZXggLSBzeCwgZXkgLSBzeSk7XG4gICAgcmV0dXJuIG5ldyBWZWN0b3IyKFxuICAgICAgdGhpcy5jcm9zc1JhdyhleCAtIHN4LCBleSAtIHN5LCBmeCAtIHN4LCBmeSAtIHN5KSAvIGRldCxcbiAgICAgIHRoaXMuY3Jvc3NSYXcodHggLSBmeCwgdHkgLSBmeSwgZnggLSBzeCwgZnkgLSBzeSkgLyBkZXRcbiAgICApO1xuICB9XG4gIHN0YXRpYyBpbnRlcnNlY3Rpb25UaW1lcyhcbiAgICBmcm9tOiBWZWN0b3IyLCB0bzogVmVjdG9yMiwgc3RhcnQ6IFZlY3RvcjIsIGVuZDogVmVjdG9yMlxuICApOiBWZWN0b3IyIHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy5pbnRlcnNlY3Rpb25UaW1lc1Jhdyhmcm9tLngsIGZyb20ueSwgdG8ueCwgdG8ueSwgc3RhcnQueCwgc3RhcnQueSwgZW5kLngsIGVuZC55KTtcbiAgfVxuICBpbnRlcnNlY3Rpb25UaW1lcyh0bzogVmVjdG9yMiwgc3RhcnQ6IFZlY3RvcjIsIGVuZDogVmVjdG9yMik6IFZlY3RvcjIgfCB1bmRlZmluZWQge1xuICAgIHJldHVybiBWZWN0b3IyLmludGVyc2VjdGlvblRpbWVzKHRoaXMsIHRvLCBzdGFydCwgZW5kKTtcbiAgfVxuICBzdGF0aWMgaW50ZXJzZWN0aW9uUmF3KFxuICAgIGZ4OiBudW1iZXIsIGZ5OiBudW1iZXIsIHR4OiBudW1iZXIsIHR5OiBudW1iZXIsXG4gICAgc3g6IG51bWJlciwgc3k6IG51bWJlciwgZXg6IG51bWJlciwgZXk6IG51bWJlclxuICApOiBWZWN0b3IyIHwgdW5kZWZpbmVkIHtcbiAgICBjb25zdCB0aW1lcyA9IHRoaXMuaW50ZXJzZWN0aW9uVGltZXNSYXcoZngsIGZ5LCB0eCwgdHksIHN4LCBzeSwgZXgsIGV5KTtcbiAgICBpZiAodGltZXMpIHtcbiAgICAgIHRpbWVzLnkgPSBmeSArICh0eSAtIGZ5KSAqIHRpbWVzLng7XG4gICAgICB0aW1lcy54ID0gZnggKyAodHggLSBmeCkgKiB0aW1lcy54O1xuICAgICAgcmV0dXJuIHRpbWVzO1xuICAgIH1cbiAgfVxuICBzdGF0aWMgaW50ZXJzZWN0aW9uKGZyb206IFZlY3RvcjIsIHRvOiBWZWN0b3IyLCBzdGFydDogVmVjdG9yMiwgZW5kOiBWZWN0b3IyKTogVmVjdG9yMiB8IHVuZGVmaW5lZCB7XG4gICAgcmV0dXJuIHRoaXMuaW50ZXJzZWN0aW9uUmF3KGZyb20ueCwgZnJvbS55LCB0by54LCB0by55LCBzdGFydC54LCBzdGFydC55LCBlbmQueCwgZW5kLnkpO1xuICB9XG4gIGludGVyc2VjdGlvbih0bzogVmVjdG9yMiwgc3RhcnQ6IFZlY3RvcjIsIGVuZDogVmVjdG9yMik6IFZlY3RvcjIgfCB1bmRlZmluZWQge1xuICAgIHJldHVybiBWZWN0b3IyLmludGVyc2VjdGlvbih0aGlzLCB0bywgc3RhcnQsIGVuZCk7XG4gIH1cbiAgYW5nbGUob3RoZXI/OiBWZWN0b3IyKTogbnVtYmVyIHtcbiAgICBpZiAob3RoZXIpIHtcbiAgICAgICBjb25zdCBhMSA9IHRoaXMuYW5nbGUoKTtcbiAgICAgICBjb25zdCBhMiA9IG90aGVyLmFuZ2xlKCk7XG4gICAgICAgaWYgKGEyIDwgYTEpIHtcbiAgICAgICAgcmV0dXJuIGEyICsgMiAqIE1hdGguUEkgLSBhMTtcbiAgICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gYTIgLSBhMTtcbiAgICAgICB9XG4gICAgfSBlbHNlIGlmICh0aGlzLnkgPiAwKSB7XG4gICAgICByZXR1cm4gTWF0aC5hY29zKHRoaXMueCAvIHRoaXMubGVuKCkpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gMiAqIE1hdGguUEkgLSBNYXRoLmFjb3ModGhpcy54IC8gdGhpcy5sZW4oKSk7XG4gICAgfVxuICB9XG59IiwiaW1wb3J0IHsgVmVjdG9yMiB9IGZyb20gXCIuL3ZlY3RvcjJcIjtcblxuZXhwb3J0IGNsYXNzIExpbmUge1xuICB2MTogVmVjdG9yMjtcbiAgdjI6IFZlY3RvcjI7XG4gIGNvbnN0cnVjdG9yKFxuICAgIHgxPzogbnVtYmVyLFxuICAgIHkxPzogbnVtYmVyLFxuICAgIHgyPzogbnVtYmVyLFxuICAgIHkyPzogbnVtYmVyXG4gICkge1xuICAgIHRoaXMudjEgPSBuZXcgVmVjdG9yMih4MSwgeTEpO1xuICAgIHRoaXMudjIgPSBuZXcgVmVjdG9yMih4MiwgeTIpO1xuICB9XG4gIGdldCB4MSgpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLnYxLng7XG4gIH1cbiAgZ2V0IHkxKCk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMudjEueTtcbiAgfVxuICBnZXQgeDIoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy52Mi54O1xuICB9XG4gIGdldCB5MigpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLnYyLnk7XG4gIH1cbiAgbGVuKCk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMudjIuc3ViKHRoaXMudjEpLmxlbigpO1xuICB9XG4gIGJlZm9yZSh0OiBudW1iZXIpOiBWZWN0b3IyIHtcbiAgICByZXR1cm4gdGhpcy52MS5hZGQodGhpcy52Mi5zdWIodGhpcy52MSkubXVsKC10IC8gdGhpcy5sZW4oKSkpO1xuICB9XG4gIGFmdGVyKHQ6IG51bWJlcik6IFZlY3RvcjIge1xuICAgIHJldHVybiB0aGlzLnYxLmFkZCh0aGlzLnYyLnN1Yih0aGlzLnYxKS5tdWwoKHRoaXMubGVuKCkgKyB0KSAvIHRoaXMubGVuKCkpKTtcbiAgfVxuICBpbnRlcnNlY3Rpb25UaW1lc1dpdGgob3RoZXI6IExpbmUpOiBWZWN0b3IyIHtcbiAgICByZXR1cm4gdGhpcy52MS5pbnRlcnNlY3Rpb25UaW1lcyh0aGlzLnYyLCBvdGhlci52MSwgb3RoZXIudjIpO1xuICB9XG4gIHVwZGF0ZShkeDEgPSAwLCBkeTEgPSAwLCBkeDIgPSAwLCBkeTIgPSAwKTogdm9pZCB7XG4gICAgdGhpcy52MS54ICs9IGR4MTtcbiAgICB0aGlzLnYxLnkgKz0gZHkxO1xuICAgIHRoaXMudjIueCArPSBkeDI7XG4gICAgdGhpcy52Mi55ICs9IGR5MjtcbiAgfVxufSIsImltcG9ydCB7IFBvbHBsb3RSZW5kZXJlciB9IGZyb20gXCIuL2ludGVyZmFjZXMvcG9scGxvdC1yZW5kZXJlclwiO1xuaW1wb3J0IHsgTGluZSB9IGZyb20gXCIuL2xpbmVcIjtcbmltcG9ydCB7IFZlY3RvcjIgfSBmcm9tIFwiLi92ZWN0b3IyXCI7XG5cbmV4cG9ydCBjbGFzcyBQb2xQbG90IHtcbiAgbGluZXM6IExpbmVbXSA9IFtdO1xuICBpbnRlcnNlY3Rpb25UaW1lczogbnVtYmVyW11bXSA9IFtdO1xuICBjb25zdHJ1Y3RvcihyZWFkb25seSByZW5kZXJlcjogUG9scGxvdFJlbmRlcmVyKSB7XG4gICAgbGV0IGRyYWdnZWRMaW5lOiBMaW5lO1xuICAgIGxldCBkcmFnZ2VkVmVjdG9yMjogVmVjdG9yMjtcblxuICAgIHRoaXMucmVuZGVyZXIuc2V0TW91c2VEb3duSGFuZGxlcigoZXZlbnQsIGNsaWNrZWRMaW5lLCBjbGlja2VkVmVjdG9yMikgPT4ge1xuICAgICAgZHJhZ2dlZExpbmUgPSBjbGlja2VkTGluZSB8fCBudWxsO1xuICAgICAgZHJhZ2dlZFZlY3RvcjIgPSBjbGlja2VkVmVjdG9yMiB8fCBudWxsO1xuICAgICAgaWYgKCFkcmFnZ2VkTGluZSkge1xuICAgICAgICBkcmFnZ2VkTGluZSA9IG5ldyBMaW5lKGV2ZW50LmNsaWVudFgsIGV2ZW50LmNsaWVudFksIGV2ZW50LmNsaWVudFgsIGV2ZW50LmNsaWVudFkpO1xuICAgICAgICBkcmFnZ2VkVmVjdG9yMiA9IGRyYWdnZWRMaW5lLnYyO1xuICAgICAgICB0aGlzLmFkZExpbmUoZHJhZ2dlZExpbmUpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgbGV0IHNlbGVjdGVkTGluZTogTGluZTtcbiAgICB0aGlzLnJlbmRlcmVyLnNldE1vdXNlVXBIYW5kbGVyKChldmVudCwgY2xpY2tlZExpbmUsIGNsaWNrZWRWZWN0b3IyKSA9PiB7XG4gICAgICBpZiAoY2xpY2tlZExpbmUpIHtcbiAgICAgICAgaWYgKHNlbGVjdGVkTGluZSAmJiBzZWxlY3RlZExpbmUgIT09IGNsaWNrZWRMaW5lKSB7XG4gICAgICAgICAgdGhpcy5yZW5kZXJlci5kcmF3TGluZShzZWxlY3RlZExpbmUsIGNsaWNrZWRMaW5lID09PSBob3ZlcmVkTGluZSwgZmFsc2UpO1xuICAgICAgICB9XG4gICAgICAgIHNlbGVjdGVkTGluZSA9IGNsaWNrZWRMaW5lO1xuICAgICAgICB0aGlzLnJlbmRlcmVyLmRyYXdMaW5lKHNlbGVjdGVkTGluZSwgY2xpY2tlZExpbmUgPT09IGhvdmVyZWRMaW5lLCB0cnVlKTtcbiAgICAgIH0gZWxzZSBpZiAoc2VsZWN0ZWRMaW5lKSB7XG4gICAgICAgIHRoaXMucmVuZGVyZXIuZHJhd0xpbmUoc2VsZWN0ZWRMaW5lLCBjbGlja2VkTGluZSA9PT0gaG92ZXJlZExpbmUsIGZhbHNlKTtcbiAgICAgIH1cbiAgICAgIGRyYWdnZWRMaW5lID0gbnVsbDtcbiAgICAgIGRyYWdnZWRWZWN0b3IyID0gbnVsbDtcbiAgICB9KTtcblxuICAgIGxldCBob3ZlcmVkTGluZTogTGluZTtcbiAgICB0aGlzLnJlbmRlcmVyLnNldE1vdXNlTW92ZUhhbmRsZXIoKGV2ZW50LCBjbGlja2VkTGluZSwgY2xpY2tlZFZlY3RvcjIpID0+IHtcbiAgICAgIGlmIChjbGlja2VkTGluZSkge1xuICAgICAgICBpZiAoaG92ZXJlZExpbmUgJiYgaG92ZXJlZExpbmUgIT09IGNsaWNrZWRMaW5lKSB7XG4gICAgICAgICAgdGhpcy5yZW5kZXJlci5kcmF3TGluZShob3ZlcmVkTGluZSwgZmFsc2UsIGNsaWNrZWRMaW5lID09PSBzZWxlY3RlZExpbmUpO1xuICAgICAgICB9XG4gICAgICAgIGhvdmVyZWRMaW5lID0gY2xpY2tlZExpbmU7XG4gICAgICAgIHRoaXMucmVuZGVyZXIuZHJhd0xpbmUoaG92ZXJlZExpbmUsIHRydWUsIGNsaWNrZWRMaW5lID09PSBzZWxlY3RlZExpbmUpOyBcbiAgICAgIH0gZWxzZSBpZiAoaG92ZXJlZExpbmUpIHtcbiAgICAgICAgdGhpcy5yZW5kZXJlci5kcmF3TGluZShob3ZlcmVkTGluZSwgZmFsc2UsIGNsaWNrZWRMaW5lID09PSBzZWxlY3RlZExpbmUpO1xuICAgICAgICBob3ZlcmVkTGluZSA9IG51bGw7XG4gICAgICB9XG4gICAgICBpZiAoZHJhZ2dlZExpbmUpIHtcbiAgICAgICAgaWYgKGRyYWdnZWRWZWN0b3IyKSB7XG4gICAgICAgICAgZHJhZ2dlZFZlY3RvcjIueCA9IGV2ZW50LmNsaWVudFg7XG4gICAgICAgICAgZHJhZ2dlZFZlY3RvcjIueSA9IGV2ZW50LmNsaWVudFk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZHJhZ2dlZExpbmUudXBkYXRlKGV2ZW50Lm1vdmVtZW50WCwgZXZlbnQubW92ZW1lbnRZLCBldmVudC5tb3ZlbWVudFgsIGV2ZW50Lm1vdmVtZW50WSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy51cGRhdGVJbnRlcnNlY3Rpb25UaW1lcyhkcmFnZ2VkTGluZSk7XG4gICAgICAgIHRoaXMucmVuZGVyZXIuZHJhd0xpbmUoZHJhZ2dlZExpbmUsIGRyYWdnZWRMaW5lID09PSBob3ZlcmVkTGluZSwgZHJhZ2dlZExpbmUgPT09IHNlbGVjdGVkTGluZSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cbiAgYWRkTGluZShsaW5lOiBMaW5lKTogdm9pZCB7XG4gICAgdGhpcy5hZGRJbnRlcnNlY3Rpb25UaW1lcyhsaW5lKTtcbiAgICB0aGlzLmxpbmVzLnB1c2gobGluZSk7XG4gICAgdGhpcy5yZW5kZXJlci5kcmF3TGluZShsaW5lLCBmYWxzZSwgZmFsc2UpO1xuICB9XG4gIGFkZEludGVyc2VjdGlvblRpbWVzKGxpbmU6IExpbmUpOiB2b2lkIHtcbiAgICBjb25zdCBpbnRlcnNlY3Rpb25UaW1lczogbnVtYmVyW10gPSBbXTtcbiAgICBsZXQgdGltZXM6IFZlY3RvcjI7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmxpbmVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICB0aW1lcyA9IHRoaXMubGluZXNbaV0uaW50ZXJzZWN0aW9uVGltZXNXaXRoKGxpbmUpO1xuICAgICAgdGhpcy5pbnRlcnNlY3Rpb25UaW1lc1tpXS5wdXNoKHRpbWVzLngpO1xuICAgICAgaW50ZXJzZWN0aW9uVGltZXMucHVzaCh0aW1lcy55KTtcbiAgICB9XG4gICAgdGhpcy5pbnRlcnNlY3Rpb25UaW1lcy5wdXNoKGludGVyc2VjdGlvblRpbWVzKTtcbiAgfVxuICB1cGRhdGVJbnRlcnNlY3Rpb25UaW1lcyhsaW5lOiBMaW5lKTogdm9pZCB7XG4gICAgY29uc3QgaW5kZXggPSB0aGlzLmxpbmVzLmluZGV4T2YobGluZSk7XG4gICAgbGV0IHRpbWVzOiBWZWN0b3IyO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5saW5lcy5sZW5ndGg7IGkrKykge1xuICAgICAgaWYgKGkgIT09IGluZGV4KSB7XG4gICAgICAgIHRpbWVzID0gdGhpcy5saW5lc1tpXS5pbnRlcnNlY3Rpb25UaW1lc1dpdGgobGluZSk7XG4gICAgICAgIHRoaXMuaW50ZXJzZWN0aW9uVGltZXNbaV1baW5kZXhdID0gdGltZXMueDtcbiAgICAgICAgdGhpcy5pbnRlcnNlY3Rpb25UaW1lc1tpbmRleF1baV0gPSB0aW1lcy55O1xuICAgICAgfVxuICAgIH1cbiAgICBjb25zb2xlLmxvZyh0aGlzLmludGVyc2VjdGlvblRpbWVzKTtcbiAgfVxufSIsImltcG9ydCB7IENsaWNrSGFuZGxlciwgUG9scGxvdFJlbmRlcmVyIH0gZnJvbSBcIi4vaW50ZXJmYWNlcy9wb2xwbG90LXJlbmRlcmVyXCI7XG5pbXBvcnQgeyBMaW5lIH0gZnJvbSBcIi4vbGluZVwiO1xuXG5jb25zdCBnVGVtcGxhdGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoJ2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJywgJ2cnKTtcbmdUZW1wbGF0ZS5zZXRBdHRyaWJ1dGUoJ3N0cm9rZScsICdibGFjaycpO1xuZ1RlbXBsYXRlLnNldEF0dHJpYnV0ZSgnc3Ryb2tlLXdpZHRoJywgJzAuNHB4Jyk7XG5cbmNvbnN0IGxpbmVUZW1wbGF0ZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLCAnbGluZScpO1xubGluZVRlbXBsYXRlLnNldEF0dHJpYnV0ZSgnc3Ryb2tlLWRhc2hhcnJheScsICcxMCwgNCwgMSwgNCcpO1xuXG5jb25zdCBhbmNob3JUZW1wbGF0ZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLCAncGF0aCcpO1xuYW5jaG9yVGVtcGxhdGUuc2V0QXR0cmlidXRlKFxuICAnZCcsXG4gICdNIDAsIDAnICtcbiAgJ0EgMTAsIDEwLCAwLCAwLCAwLCAtNSwgLTUnICsgXG4gICdBIDEwLCAxMCwgMCwgMSwgMSwgNSwgLTUnICtcbiAgJ0EgMTAsIDEwLCAwLCAwLCAwLCAwLCAwJ1xuKTtcbmFuY2hvclRlbXBsYXRlLnNldEF0dHJpYnV0ZSgnZmlsbCcsICd3aGl0ZScpO1xuXG5nVGVtcGxhdGUuYXBwZW5kQ2hpbGQobGluZVRlbXBsYXRlKTtcbmdUZW1wbGF0ZS5hcHBlbmRDaGlsZChhbmNob3JUZW1wbGF0ZSk7XG5nVGVtcGxhdGUuYXBwZW5kQ2hpbGQoYW5jaG9yVGVtcGxhdGUuY2xvbmVOb2RlKCkpO1xuXG5leHBvcnQgY2xhc3MgU3ZnUmVuZGVyZXIgaW1wbGVtZW50cyBQb2xwbG90UmVuZGVyZXIge1xuICByZWFkb25seSBzdmcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoJ2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJywgJ3N2ZycpO1xuICBwcml2YXRlIHN2Z0dCeUxpbmUgPSBuZXcgTWFwPExpbmUsIFNWR0dFbGVtZW50PigpO1xuICBwcml2YXRlIGxpbmVCeVN2Z0cgPSBuZXcgTWFwPFNWR0dFbGVtZW50LCBMaW5lPigpO1xuICBwcml2YXRlIG9uTW91c2VEb3duOiAoZXZlbnQ6IE1vdXNlRXZlbnQpID0+IGFueTtcbiAgcHJpdmF0ZSBvbk1vdXNlVXA6IChldmVudDogTW91c2VFdmVudCkgPT4gYW55O1xuICBwcml2YXRlIG9uTW91c2VNb3ZlOiAoZXZlbnQ6IE1vdXNlRXZlbnQpID0+IGFueTtcbiAgY2xpY2tIYW5kbGVyV3JhcHBlcihjbGlja0hhbmRsZXI6IENsaWNrSGFuZGxlcik6IChldmVudDogTW91c2VFdmVudCkgPT4gYW55IHtcbiAgICByZXR1cm4gZXZlbnQgPT4ge1xuICAgICAgY29uc3QgZWxlbWVudEF0ID0gZG9jdW1lbnQuZWxlbWVudEZyb21Qb2ludChldmVudC5jbGllbnRYLCBldmVudC5jbGllbnRZKTtcbiAgICAgIGNvbnN0IGxpbmUgPSB0aGlzLmxpbmVCeVN2Z0cuZ2V0KGVsZW1lbnRBdC5wYXJlbnROb2RlIGFzIFNWR0dFbGVtZW50KTtcbiAgICAgIGlmIChlbGVtZW50QXQgaW5zdGFuY2VvZiBTVkdQYXRoRWxlbWVudCkge1xuICAgICAgICBpZiAoZWxlbWVudEF0LnBhcmVudE5vZGUuY2hpbGRyZW5bMV0gPT09IGVsZW1lbnRBdCkge1xuICAgICAgICAgIGNsaWNrSGFuZGxlcihldmVudCwgbGluZSwgbGluZS52MSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY2xpY2tIYW5kbGVyKGV2ZW50LCBsaW5lLCBsaW5lLnYyKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmIChlbGVtZW50QXQgaW5zdGFuY2VvZiBTVkdMaW5lRWxlbWVudCkge1xuICAgICAgICBjbGlja0hhbmRsZXIoZXZlbnQsIGxpbmUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY2xpY2tIYW5kbGVyKGV2ZW50KTtcbiAgICAgIH1cbiAgICB9O1xuICB9XG4gIHNldE1vdXNlRG93bkhhbmRsZXIoY2xpY2tIYW5kbGVyOiBDbGlja0hhbmRsZXIpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5vbk1vdXNlRG93bikge1xuICAgICAgdGhpcy5zdmcucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgdGhpcy5vbk1vdXNlRG93bik7XG4gICAgfVxuICAgIHRoaXMub25Nb3VzZURvd24gPSB0aGlzLmNsaWNrSGFuZGxlcldyYXBwZXIoY2xpY2tIYW5kbGVyKTtcbiAgICB0aGlzLnN2Zy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCB0aGlzLm9uTW91c2VEb3duKTtcbiAgfVxuICBzZXRNb3VzZVVwSGFuZGxlcihjbGlja0hhbmRsZXI6IENsaWNrSGFuZGxlcik6IHZvaWQge1xuICAgIGlmICh0aGlzLm9uTW91c2VVcCkge1xuICAgICAgdGhpcy5zdmcucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIHRoaXMub25Nb3VzZVVwKTtcbiAgICB9XG4gICAgdGhpcy5vbk1vdXNlVXAgPSB0aGlzLmNsaWNrSGFuZGxlcldyYXBwZXIoY2xpY2tIYW5kbGVyKTtcbiAgICB0aGlzLnN2Zy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgdGhpcy5vbk1vdXNlVXApO1xuICB9XG4gIHNldE1vdXNlTW92ZUhhbmRsZXIoY2xpY2tIYW5kbGVyOiBDbGlja0hhbmRsZXIpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5vbk1vdXNlTW92ZSkge1xuICAgICAgdGhpcy5zdmcucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgdGhpcy5vbk1vdXNlTW92ZSk7XG4gICAgfVxuICAgIHRoaXMub25Nb3VzZU1vdmUgPSB0aGlzLmNsaWNrSGFuZGxlcldyYXBwZXIoY2xpY2tIYW5kbGVyKTtcbiAgICB0aGlzLnN2Zy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCB0aGlzLm9uTW91c2VNb3ZlKTtcbiAgfVxuICBkcmF3TGluZShsaW5lOiBMaW5lLCBpc0hvdmVyZWQgPSBmYWxzZSwgaXNTZWxlY3RlZCA9IGZhbHNlKTogdm9pZCB7XG4gICAgbGV0IHN2Z0c6IFNWR0dFbGVtZW50O1xuICAgIGlmICghdGhpcy5zdmdHQnlMaW5lLmhhcyhsaW5lKSkge1xuICAgICAgc3ZnRyA9IGdUZW1wbGF0ZS5jbG9uZU5vZGUodHJ1ZSkgYXMgU1ZHR0VsZW1lbnQ7XG4gICAgICB0aGlzLnN2Zy5hcHBlbmRDaGlsZChzdmdHKTtcbiAgICAgIHRoaXMuc3ZnR0J5TGluZS5zZXQobGluZSwgc3ZnRyk7XG4gICAgICB0aGlzLmxpbmVCeVN2Z0cuc2V0KHN2Z0csIGxpbmUpO1xuICAgIH0gZWxzZSB7XG4gICAgICBzdmdHID0gdGhpcy5zdmdHQnlMaW5lLmdldChsaW5lKTtcbiAgICB9XG4gICAgY29uc3Qgc3ZnTGluZSA9IHN2Z0cuY2hpbGRyZW5bMF0gYXMgU1ZHTGluZUVsZW1lbnQ7XG4gICAgY29uc3Qgc3ZnUGF0aEFuY2hvclN0YXJ0ID0gc3ZnRy5jaGlsZHJlblsxXSBhcyBTVkdQYXRoRWxlbWVudDtcbiAgICBjb25zdCBzdmdQYXRoQW5jaG9yRW5kID0gc3ZnRy5jaGlsZHJlblsyXSBhcyBTVkdQYXRoRWxlbWVudDtcbiAgICBjb25zdCB4MSA9IGxpbmUueDEudG9GaXhlZCgpO1xuICAgIGNvbnN0IHkxID0gbGluZS55MS50b0ZpeGVkKCk7XG4gICAgY29uc3QgeDIgPSBsaW5lLngyLnRvRml4ZWQoKTtcbiAgICBjb25zdCB5MiA9IGxpbmUueTIudG9GaXhlZCgpO1xuICAgIHN2Z0xpbmUuc2V0QXR0cmlidXRlKCd4MScsIHgxKTtcbiAgICBzdmdMaW5lLnNldEF0dHJpYnV0ZSgneTEnLCB5MSk7XG4gICAgc3ZnTGluZS5zZXRBdHRyaWJ1dGUoJ3gyJywgeDIpO1xuICAgIHN2Z0xpbmUuc2V0QXR0cmlidXRlKCd5MicsIHkyKTtcbiAgICBpZiAoaXNIb3ZlcmVkKSB7XG4gICAgICBzdmdHLnNldEF0dHJpYnV0ZSgnc3Ryb2tlLXdpZHRoJywgJzAuOHB4Jyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHN2Z0cuc2V0QXR0cmlidXRlKCdzdHJva2Utd2lkdGgnLCAnMC40cHgnKTtcbiAgICB9XG4gICAgaWYgKGlzU2VsZWN0ZWQpIHtcbiAgICAgIHN2Z0cuc2V0QXR0cmlidXRlKCdzdHJva2UnLCAnIzE5YTE5NCcpO1xuICAgIH0gZWxzZSB7XG4gICAgICBzdmdHLnNldEF0dHJpYnV0ZSgnc3Ryb2tlJywgJ2JsYWNrJyk7XG4gICAgfVxuICAgIGNvbnN0IGFuZ2xlID0gMTgwICogKGxpbmUudjIuc3ViKGxpbmUudjEpLmFuZ2xlKCkgLSBNYXRoLlBJIC8gMikgLyBNYXRoLlBJO1xuICAgIHN2Z1BhdGhBbmNob3JTdGFydC5zZXRBdHRyaWJ1dGUoJ3RyYW5zZm9ybScsIGB0cmFuc2xhdGUoJHt4MX0sICR7eTF9KSByb3RhdGUoJHtpc05hTihhbmdsZSkgPyAwIDogYW5nbGV9KWApO1xuICAgIHN2Z1BhdGhBbmNob3JFbmQuc2V0QXR0cmlidXRlKCd0cmFuc2Zvcm0nLCBgdHJhbnNsYXRlKCR7eDJ9LCAke3kyfSkgcm90YXRlKCR7aXNOYU4oYW5nbGUpID8gMCA6IDE4MCArIGFuZ2xlfSlgKTtcbiAgfVxuICBlcmFzZUxpbmUobGluZTogTGluZSk6IHZvaWQge1xuICAgIGNvbnN0IHN2Z0cgPSB0aGlzLnN2Z0dCeUxpbmUuZ2V0KGxpbmUpO1xuICAgIGlmIChzdmdHKSB7XG4gICAgICB0aGlzLnN2Zy5yZW1vdmVDaGlsZChzdmdHKTtcbiAgICAgIHRoaXMuc3ZnR0J5TGluZS5kZWxldGUobGluZSk7XG4gICAgfVxuICB9XG59IiwiaW1wb3J0IHsgUG9sUGxvdCB9IGZyb20gXCIuL3BvbHBsb3RcIjtcbmltcG9ydCB7IFN2Z1JlbmRlcmVyIH0gZnJvbSBcIi4vc3ZnLXJlbmRlcmVyXCI7XG5cbmNvbnN0IHN2Z1JlbmRlcmVyID0gbmV3IFN2Z1JlbmRlcmVyKCk7XG5jb25zdCBwb2xwbG90ID0gbmV3IFBvbFBsb3Qoc3ZnUmVuZGVyZXIpO1xuY29uc3QgYm9keSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2JvZHknKTtcbmJvZHkuYXBwZW5kQ2hpbGQoc3ZnUmVuZGVyZXIuc3ZnKTsiXSwic291cmNlUm9vdCI6IiJ9